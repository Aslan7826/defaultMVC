<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" 
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension"
     xmlns:bal="http://schemas.microsoft.com/wix/BalExtension"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
  <Bundle Name="DemoUse.Bootstrapper" Version="1.0.0.0" Manufacturer="Demo" UpgradeCode="37bbfd2f-0889-4b32-90db-eea5cbea61ce" DisableModify="yes" DisableRemove="yes">
    <BootstrapperApplicationRef Id="ManagedBootstrapperApplicationHost" >
      <Payload SourceFile="$(var.DemoUse.WPFView.TargetDir)DemoUse.WPFView.dll" />
      <Payload SourceFile="$(var.DemoUse.WPFView.TargetDir)BootstrapperCore.config" />
    </BootstrapperApplicationRef>
    <WixVariable Id="WixMbaPrereqLicenseUrl" Value=""/>
    <WixVariable Id="WixMbaPrereqPackageId" Value=""/>
    <Chain>
      <PackageGroupRef Id="AspNetCoreRuntime31Web"/>
      <MsiPackage Id="DemoInstaller" SourceFile="$(var.DemoUse.Installer.TargetDir)DemoUse.Installer.msi"
              Compressed="yes" DisplayInternalUI="yes" Visible="yes" />
    </Chain>
  </Bundle>

  <Fragment>
    <Variable Name="AspNetCoreRuntime31InstallDir" Value="[ProgramFiles64Folder]dotnet\shared\Microsoft.AspNetCore.App\3.1.0" />
    <util:DirectorySearch Id="AspNetCoreRuntime31Installed" Path="[AspNetCoreRuntime31InstallDir]" Variable="AspNetCoreRuntime31Installed" Result="exists" />

    <WixVariable Id="AspNetCoreRuntime31WebDetectCondition" Value="AspNetCoreRuntime31Installed" Overridable="yes" />
    <WixVariable Id="AspNetCoreRuntime31WebInstallCondition" Value="" Overridable="yes" />

    <PackageGroup Id="AspNetCoreRuntime31Web">
      <ExePackage
          Name="aspnetcore-runtime-3.1.0-win-x64.exe"
          InstallCommand="/install /quiet /norestart /log &quot;[AspNetCoreRuntime31Log]&quot;"
          RepairCommand="/repair /quiet /norestart /log &quot;[AspNetCoreRuntime31Log]&quot;"
          UninstallCommand="/uninstall /quiet /norestart /log &quot;[AspNetCoreRuntime31Log]&quot;"
          PerMachine="yes"
          DetectCondition="!(wix.AspNetCoreRuntime31WebDetectCondition)"
          InstallCondition="!(wix.AspNetCoreRuntime31WebInstallCondition)"
          Vital="yes"
          Permanent="yes"
          Protocol="burn"
          SourceFile="aspnetcore-runtime-3.1.0-win-x64.exe"
          LogPathVariable="AspNetCoreRuntime31Log"
          Compressed="yes">
      </ExePackage>
    </PackageGroup>
  </Fragment>

  <Fragment>
    <Variable Name="WindowsDesktopRuntime31InstallDir" Value="[ProgramFiles64Folder]dotnet\shared\Microsoft.WindowsDesktop.App\3.1.0" />
    <util:DirectorySearch Id="WindowsDesktopRuntime31Installed" Path="[WindowsDesktopRuntime31InstallDir]" Variable="WindowsDesktopRuntime31Installed" Result="exists" />

    <WixVariable Id="WindowsDesktopRuntime31WebDetectCondition" Value="WindowsDesktopRuntime31Installed" Overridable="yes" />
    <WixVariable Id="WindowsDesktopRuntime31WebInstallCondition" Value="" Overridable="yes" />

    <PackageGroup Id="WindowsDesktopRuntime31Web">
      <ExePackage
          Name="windowsdesktop-runtime-3.1.0-win-x64.exe"
          InstallCommand="/install /quiet /norestart /log &quot;[WindowsDesktopRuntime31Log]&quot;"
          RepairCommand="/repair /quiet /norestart /log &quot;[WindowsDesktopRuntime31Log]&quot;"
          UninstallCommand="/uninstall /quiet /norestart /log &quot;[WindowsDesktopRuntime31Log]&quot;"
          PerMachine="yes"
          DetectCondition="!(wix.WindowsDesktopRuntime31WebDetectCondition)"
          InstallCondition="!(wix.WindowsDesktopRuntime31WebInstallCondition)"
          Vital="yes"
          Permanent="yes"
          Protocol="burn"
          DownloadUrl="https://download.visualstudio.microsoft.com/download/pr/a1510e74-b31a-4434-b8a0-8074ff31fb3f/b7de8ecba4a14d8312551cfdc745dea1/windowsdesktop-runtime-3.1.0-win-x64.exe"
          LogPathVariable="WindowsDesktopRuntime31Log"
          Compressed="no">
        <!-- heat.exe payload "windowsdesktop-runtime-3.1.0-win-x64.exe" -o "windowsdesktop-runtime.wxs" -->
        <RemotePayload
          CertificatePublicKey="6608A9DBA86701156A4C17CE63BA99BE8B932F8D"
          CertificateThumbprint="62009AAABDAE749FD47D19150958329BF6FF4B34"
          Description="Microsoft Windows Desktop Runtime - 3.1.0 (x64)"
          Hash="C16F271754879BA78868947486F37871C9F0E40F"
          ProductName="Microsoft Windows Desktop Runtime - 3.1.0 (x64)"
          Size="54443856"
          Version="3.1.0.28315" />
      </ExePackage>
    </PackageGroup>
  </Fragment>
</Wix>
